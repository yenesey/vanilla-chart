!function(){"use strict";var m=Math.min,j=Math.max,F=Math.round,H=Math.abs;function o(t,i,n,e){for(var o=0;o<i.length;o++)!1===e?t.removeEventListener(i[o],n):t.addEventListener(i[o],n)}var n={padding:10,minimapHeightRel:.14,minimapBandSize:12,colors:{background:"#fff",minimap:"#f8f8ff",minimapFrame:"#c8dde8",minimapDrag:"rgba(200, 190, 190, 0.2)",label:"#aaa"}},e={run:!1,duration:250,ts:0,from:0,to:0,pos:0,onComplete:null};function t(t,i){if(this.data=null,this.visible={},this.options=n,this.container=document.getElementById(t),!this.container)throw new Error("chart container not found!");this.canvas=this.container.appendChild(document.createElement("canvas")),this.ctx=this.canvas.getContext("2d"),this.ctx.font=window.getComputedStyle(this.container,null).font,this.font=this.ctx.font,this.vw=0,this.vh=0,this.select=-1,this.controls={h:0,vh:0,widths:[0]},this.minimap={left:0,right:0,rlLeft:.75,rlRight:1,vh:0},this._transitions={minimap:Object.create(e),graph:Object.create(e),pointer:Object.create(e)},this.setData(i);o(window,["resize","load"],function(){this.vw=this.canvas.width=this.container.clientWidth,this.vh=this.canvas.height=this.container.clientHeight,this.minimap.left=F(this.vw*this.minimap.rlLeft),this.minimap.right=F(this.vw*this.minimap.rlRight),this.minimap.vh=F(this.vh*this.options.minimapHeightRel),this.controls.vh=F(.15*this.vh)*(1+Math.floor((this.controls.widths[0]+this.controls.h)/this.vw)),this.select=-1,this.draw()}.bind(this)),o(this.canvas,["mousemove","toucmove"],this.move.bind(this)),o(this.canvas,["mousedown","touchstart"],this.mousetouch.bind(this))}(function(){var s=0,h=0,a={mode:0,start:0,left:0,right:0,runBnd:null,doneBnd:null};function l(t){var i=t.minimap,n=F(.1*i.vh);return{y:t.vh-i.vh+n-t.controls.vh,x:i.left,w:i.right-i.left,h:i.vh-2*n}}function f(t,i){var n=t.options.padding,e=t.controls,o=n,r=1,s=t.vh-e.vh+n;for(var h in t.data.names)i({x:o,y:s,w:e.widths[r],h:e.h},h),(o=o+e.widths[r]+n)>t.vw-(e.h+2*n)&&(o=n,s=s+e.h+n),r++}function r(t,i,n){return n.x<=t&&t<=n.x+n.w&&n.y<=i&&i<=n.y+n.h}function z(t,i){for(var n=0;n<t.columns.length;n++)if(t.columns[n][0]===i)return t.columns[n];return null}function E(t,n,e){return t.replace(/(\d*\.?\d+)px/,function(t,i){return(e?"bold ":"")+Number(Number(i)+n)+"px"})}function W(t,i){return String.prototype.substr.apply(new Date(t),[[0,3],[4,11],[4,6],[11,4]][i])}function X(t,i,n,e,o,r,s){var h=["arcTo","lineTo"];return s=s||[0,0,0,0],t.moveTo(i+r,n),t[h[s[0]]](i+e,n,i+e,n+o,r),t[h[s[1]]](i+e,n+o,i,n+o,r),t[h[s[2]]](i,n+o,i,n,r),t[h[s[3]]](i,n,i+e,n,r),t}function c(t,i,n,e,o,r,s,h,a,l,f,c,m,u,d){var v=t.measureText("M").width;u&&(o=o-v-8);var p=s/r,g=h/r,w=r/(i.columns[0].length-2),y=1/(g-p),x=o/f,b=e+o,T=0;for(var S in t.lineWidth=c,t.lineJoin="round",n){T++,t.beginPath(),t.strokeStyle=i.colors[S];for(var B=z(i,S),P=a;P<=l;P++)t.lineTo((P*w-s)*y,b-B[P+1]*x);t.stroke()}if(u&&0===T){var M="No data to display",k=t.measureText(M).width;return t.fillStyle=d,t.font=E(t.font,4,!1),void t.fillText(M,r/2-k/2,o/2)}if(u){t.lineWidth=.2,t.beginPath(),t.strokeStyle="grey";var R=f/8;t.fillStyle=d;for(e=0;e<8;e++)t.moveTo(0,b-e*R*x),t.lineTo(r,b-e*R*x),t.fillText(F(e*R).toString(),5,b-e*R*x-v);t.stroke();var L=8*v,C=j(H(l-a)/r*L,1),D=z(i,"x");for(P=a;P<l;P++){var I=W(D[P+1],2),Y=t.measureText(I).width;P%F(C)==0&&(t.fillStyle=d,t.fillText(I,F((P*w-s)*y-Y/2),b+v+6))}if(-1!==m){P=F((s*y+m)/(y*w));t.beginPath(),t.strokeStyle="grey",t.lineWidth=.5;var _=P*w*y-s*y;for(var S in t.moveTo(_,1.8*v),t.lineTo(_,o-1.8*v),t.stroke(),t.lineWidth=c,n){B=z(i,S);t.beginPath(),t.strokeStyle=i.colors[S],t.fillStyle="#fff";e=b-B[P+1]*x;t.arc(_,e,4,0,2*Math.PI,!1),t.fill(),t.stroke()}!function(t,i,n,e,o,r,s,h){var a=z(e,"x")[o],l=W(a,0)+", "+W(a,2),f=t.measureText(l).width,c={},m=0;for(var u in e.names)c[u]={},c[u].name=e.names[u],c[u].value=z(e,u)[o],c[u].width=j(t.measureText(c[u].name).width,t.measureText(c[u].value).width),c[u].color=e.colors[u],m+=c[u].width+10;(i-=(m=j(f,m)+10)/2)<0&&(i=0),h<i+m&&(i=h-m),t.fillStyle="rgba(255,255,255, 0.9)",t.strokeStyle="#eee",t.beginPath(),X(t,i,1,m,3*r+10,6).fill(),t.stroke(),t.fillStyle=s,t.beginPath(),t.fillText(l,i+m/2-f/2,r+2.5);var d=0,v=i,p=t.font,g=E(t.font,2,!0);for(u in c)t.fillStyle=c[u].color,d=c[u].width,t.font=g,t.fillText(c[u].value,v+10,2*r+2.5),t.font=p,t.fillText(c[u].name,v+10,3*r+2.5),v=v+d+10;t.fill()}(t,_,0,i,P+1,1.8*v,d,r)}}}function t(){var t=this.ctx;t.fillStyle=this.options.colors.background,t.fillRect(0,0,this.vw,this.vh),t.font=this.font,function(t){var i=t.ctx,n=t.options.minimapBandSize,e=t.options.colors,o=l(t);i.beginPath(),i.fillStyle=e.minimap,i.fillRect(0,o.y,o.x+n,o.h),i.fillRect(o.x+o.w-n,o.y,t.vw-o.x-o.w+n,o.h),i.fillStyle=e.minimapFrame,X(i,o.x,o.y,n,o.h,6,[1,1,0,0]),X(i,o.x+o.w-n,o.y,n,o.h,6,[0,0,1,1]),i.fill(),i.fillRect(o.x+n,o.y,o.w-2*n,2),i.fillRect(o.x+n,o.y+o.h-2,o.w-2*n,2),c(i,t.data,t.visible,o.y,o.h,t.vw,0,t.vw,0,t.dataLength,t.getMaxY(1,t.dataLength),1,-1,!1),0!==a.mode&&(i.beginPath(),i.fillStyle=e.minimapDrag,i.arc(o.x+[0,n/2,o.w-n/2,o.w/2][a.mode],o.y+o.h/2,t._transitions.minimap.pos,0,2*Math.PI,!1),i.fill())}(this),function(n){var e=n.ctx;e.font=E(n.font,2);var o=n.data;f(n,function(t,i){e.beginPath(),e.fillStyle=n.options.colors.minimap,X(e,t.x,t.y,t.w,t.h,t.h/2).fill(),e.textBaseline="middle",i in n.visible?(e.beginPath(),e.fillStyle=o.colors[i],e.arc(t.x+t.h/2,t.y+t.h/2,t.h/3,0,2*Math.PI,!1),e.fill(),e.beginPath(),e.fillStyle="#fff",e.fillText("âœ“",t.x+t.h/3,t.y+t.h/2)):(e.beginPath(),e.strokeStyle=o.colors[i],e.arc(t.x+t.h/2,t.y+t.h/2,t.h/3,0,2*Math.PI,!1),e.stroke()),e.fillStyle=o.colors[i],e.beginPath(),e.fillText(o.names[i],t.x+t.h,t.y+t.h/2),e.textBaseline="bottom"})}(this);var i=F(this.vh-this.minimap.vh-this.controls.vh),n=this.vw/(this.dataLength-1),e=F(this.minimap.left/n),o=F(this.minimap.right/n);t.font=this.font,c(t,this.data,this.visible,0,i,this.vw,this.minimap.left,this.minimap.right,e,o,this._transitions.graph.pos,2,this.select,!0,this.options.colors.label);var r=this._transitions.pointer.pos;0<r&&(t.beginPath(),t.fillStyle="rgba(200, 190, 190, 0.2)",t.arc(s,h,r,0,2*Math.PI,!1),12<r&&t.arc(s,h,r-12,0,2*Math.PI,!0),t.fill()),function(t){var i=!1;for(var n in t){var e=t[n];i=i||e.run,e.run&&(e.pos=e.from+(e.to-e.from)/e.duration*(performance.now()-e.ts),(e.to>e.from&&e.pos>=e.to||e.to<e.from&&e.pos<=e.to||e.to===e.from)&&(e.run=!1,e.pos=e.to,e.onComplete&&e.onComplete()))}return i}(this._transitions)&&this.draw()}this.draw=function(){requestAnimationFrame(t.bind(this))},this.move=function(t){var i=t.target.getBoundingClientRect();"touchstart"===t.type&&(t=t.targetTouches[0]);var n=t.clientX-i.left;t.clientY-i.top<this.vh-this.minimap.vh-this.controls.vh&&(this.select=n,this.draw())},this.mousetouch=function(t){if(!a.runBnd&&!a.doneBnd){var i=t.target.getBoundingClientRect(),n=t;if("touchstart"===t.type&&(t=t.targetTouches[0]),s=t.clientX-i.left,h=t.clientY-i.top,a.mode=function(t,i,n){var e=l(t),o=t.options.minimapBandSize;return n<e.y?7:r(i,n,e)?i<e.x+o?1:i>e.x+e.w-o?2:3:0}(this,s,h),0<a.mode)t.target.style.cursor="w-resize",a.start=t.clientX,a.left=this.minimap.left,a.right=this.minimap.right,a.runBnd=function(t){this.select=-1,"touchmove"===t.type&&(t=t.targetTouches[0]);var i=t.clientX-a.start,n=this.minimap,e=this.options.minimapBandSize;4&a.mode&&(i=-i),1&a.mode&&(n.left=a.left+i,n.left=j(n.left,1),n.left=m(n.left,n.right-2*e-1)),2&a.mode&&(n.right=a.right+i,n.right=m(n.right,this.vw-1),n.right=j(n.right,n.left+2*e+1)),n.rlLeft=n.left/this.vw,n.rlRight=n.right/this.vw;var o=this.vw/(this.dataLength-1),r=F(n.left/o),s=F(n.right/o);this.initTransition("graph","current",this.getMaxY(r,s))}.bind(this),a.doneBnd=function(t){"touchmove"!==t.type&&(t.target.style.cursor="default"),o(document,["mousemove","touchmove"],a.runBnd,!1),o(document,["mouseup","touchend"],a.doneBnd,!1),a.runBnd=null,a.doneBnd=null,this.initTransition("minimap","current",0,function(){a.mode=0})}.bind(this),o(document,["mousemove","touchmove"],a.runBnd),o(document,["mouseup","touchend"],a.doneBnd),this.initTransition("minimap","current",F(this.minimap.vh/2));else{var e=this;f(this,function(t,i){r(s,h,t)&&(n.preventDefault(),e.setVisibility(i),e.initTransition("pointer","current",50,function(){e._transitions.pointer.pos=0}.bind(e)))})}}},this.setData=function(t){this.data=t;try{this.dataLength=t.columns[0].length-1}catch(t){throw new TypeError("incorrect <inputData> format")}var i=this.ctx;i.font=E(this.font,2,!0),this.controls.h=3*i.measureText("M").width;var n=this.controls.widths=[0];for(var e in t.names){var o=i.measureText(t.names[e]).width+this.controls.h+this.options.padding;n.push(o),n[0]+=o,this.visible[e]=!0}this.initTransition("graph","current",this.getMaxY())},this.getMaxY=function(t,i){var n=0;for(var e in t=t||0,i=i||this.dataLength,this.visible)for(var o=z(this.data,e),r=t+1;r<i+1;r++)n=j(n,o[r]);return n},this.setVisibility=function(t,i){void 0===i?t in this.visible?delete this.visible[t]:this.visible[t]=!0:i?this.visible[t]=!0:delete this.visible[t],this.initTransition("graph","current",this.getMaxY())},this.initTransition=function(t,i,n,e){var o=this._transitions,r=o[t];r.from="current"===i?r.pos:i,r.pos=r.from,r.to=n,r.ts=performance.now(),r.onComplete=e;var s=!1;for(var h in o)s=s||o[h].run;s||this.draw(),r.run=!0}}).call(t.prototype),"undefined"!=typeof window&&(window.VanillaChart=t)}();